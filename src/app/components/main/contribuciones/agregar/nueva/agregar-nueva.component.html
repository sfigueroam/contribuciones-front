<div class="mdl-grid">
  <div class="mdl-cell mdl-cell--4-col linea-tiempo-1">
    <div class="pasos">
      <div class="bullet active"></div>
      <p class="active">Buscar<br><span class="mdl-layout--large-screen-only">Propiedades</span></p>
    </div>
    <i class="material-icons">keyboard_arrow_right</i>
    <div class="pasos">
      <div class="bullet"></div>
      <p>Seleccionar<br><span class="mdl-layout--large-screen-only">Deudas</span></p>
    </div>
    <i class="material-icons">keyboard_arrow_right</i>
    <div class="pasos">
      <div class="bullet"></div>
      <p>Pagar</p>
    </div>
  </div>
</div>
<div class="mdl-grid">
  <div class="mdl-cell mdl-cell--4-col m-0auto pay-title">
    <h5 class="title text-center text-mont">Buscar Mis <strong>Propiedades</strong></h5>
    <p class="text-left">Busca una o más propiedades y agrégalas al carro.</p>
  </div>
</div>
<div class="tgr-content tgr-search mdl-shadow--3dp" [class.wait]="wait">
  <div class="tgr-cell-wait">
    <div class="mdl-spinner mdl-spinner--single-color mdl-js-spinner is-active">
    </div>
  </div>
  <div class="tgr-card__head">
    <div class="tgr-switch">
      <button class="mdl-button mdl-js-button " [class.tgr-switch-active]="switchActive === 'rol'"
              (click)="changeSwith('rol')">
        Rol
      </button>
      <button class="mdl-button mdl-js-button" [class.tgr-switch-active]="switchActive === 'direccion'"
              (click)="changeSwith('direccion')">
        Dirección
      </button>
    </div>

    <span class="tgr-card__title--text small-text">Buscar por:</span>
  </div>
  <ngx-invisible-recaptcha #captchaElem
                           [siteKey]="recaptcha2.siteKey"
                           (success)="handleSuccessCaptcha2($event)"
                           [type]="recaptcha2.type"
                           [badge]="recaptcha2.badge"
                           [ngModel]="recaptcha"
                           [ngModelOptions]="{ standalone: true }">
  </ngx-invisible-recaptcha>

  <form [formGroup]="formDireccion" (submit)="buscarDireccion()">
    <div class="tgr-card__body " [class.hidden]="switchActive === 'rol'">
      <mdl-select #autocompleteSelectTipoPropiedades [class.is-invalid]="tipoPropiedad.touched && tipoPropiedad.invalid"
                  [autocomplete]="true"
                  (change)="autoCompletarPropiedad()"
                  error-msg="Debe seleccionar un tipo de propiedad"
                  [formControl]="tipoPropiedad"
                  label="Tipo Propiedad"
                  floating-label>
        <mdl-option [value]="-1">Todos</mdl-option>
        <mdl-option
          *ngFor="let tipo of tipoPropiedades| matchSorter:'descripcion':autocompleteSelectTipoPropiedades.searchQuery"
          [value]="tipo.id">{{tipo.descripcion | titlecase}}
        </mdl-option>
      </mdl-select>
      <div class="tgr-newsearch" [class.is-suggesting]="searchDireccion">
      <mdl-textfield type="text"
                     [class.is-invalid]="direccion.invalid && direccion.touched"
                     (focus)="ocultarToolbar()"
                     (blur)="mostrarToolbar()"
                     id="direccion"
                     name="direccion"
                     [formControl]="direccion"
                     (keyup)="inputDirecciones($event)"
                     (ngModel)="direccionModel"
                     floating-label
                     label="Dirección"
                     error-msg="Debe ingresar al menos 3 caracteres">
      </mdl-textfield>

        <ul class="tgr-suggestions">
          <li class="tgr-suggestion" *ngFor="let dire of direcciones | matchSorter:'direccion'"
              (click)="direccion.setValue(dire.direccion.toLowerCase()); searchDireccion = false; cargarDireccion(dire)">{{dire.direccion |
            titlecase}}
            <small>Rol: {{dire.idComunaSii | leadingZero:3}}-{{dire.rol | leadingZero:5}}-{{dire.subrol |
              leadingZero:3}}
            </small>
          </li>
        </ul>
      </div>
      <div class="tgr-card__footer .tgr-pay">
        <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored" type="submit"
                [disabled]="formDireccion.invalid">Buscar
        </button>
      </div>
    </div>
  </form>
  <div class="content tgr-card__body " [class.hidden]="switchActive === 'direccion'">
    <form [formGroup]="formRol" (ngSubmit)="buscarRol()">
      <div class="tgr-card__body ">
        <mdl-select #autocompleteSelect [class.is-invalid]="comuna.touched && comuna.invalid"
                    [autocomplete]="true"
                    (focus)="ocultarToolbar()"
                    (blur)="mostrarToolbar()"
                    error-msg="Debe seleccionar una Comuna"
                    [formControl]="comuna"
                    label="Comuna"
                    class="tgr-i-comuna"
                    floating-label>
          <mdl-option *ngFor="let local of localidad| matchSorter:'comuna,idSii':autocompleteSelect.searchQuery"
                      [value]="local.idSii">{{local.comuna | titlecase}} ({{local.idSii}})
          </mdl-option>
        </mdl-select>
        <mdl-textfield [class.is-invalid]="rol.touched && rol.invalid"
                       (focus)="ocultarToolbar()"
                       (blur)="mostrarToolbar()"
                       type="number"
                       id="rol"
                       name="rol"
                       label="Rol"
                       class="tgr-i-rol"
                       [formControl]="rol"
                       error-msg="Debe ingresar un Rol"
                       floating-label></mdl-textfield>
        -
        <mdl-textfield [class.is-invalid]="subRol.touched && subRol.invalid"
                       (focus)="ocultarToolbar()"
                       (blur)="mostrarToolbar()"
                       type="number"
                       id="subRol"
                       name="subRol"
                       class="tgr-i-subrol"
                       label="Sub Rol"
                       [formControl]="subRol"
                       error-msg="Debe ingresar un Sub Rol"
                       floating-label></mdl-textfield>
      </div>
      <div class="tgr-card__footer">
        <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored" type="submit"
                [disabled]="formRol.invalid">Buscar
        </button>
      </div>
    </form>
  </div>
</div>

<div class="tgr-results">
  <h3 [class.hidden]="!sinResultado">No se encontraron resultados, por favor modifica la búsqueda e intenta
    nuevamente</h3>
  <app-propiedad class="tgr-content mdl-shadow--3dp" *ngFor="let propiedad of propiedades" [propiedad]="propiedad"
                 (change)="updateSeleccionadaTotal()">
  </app-propiedad>
</div>

<p class="contador-propiedades">Llevas <strong>0</strong> propiedades en el carro</p>
<div class="tgr-actions">
  <div class="tgr-actions__content">

    <div class="tgr-pay tgr-agregar-nueva">

      <button id="agregar_propiedades" type="button" class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored" [disabled]="cantidadSeleccionadas == 0"
        (click)="asociarPropiedades()">
        Agregar {{cantidadSeleccionadas}} propiedades
      </button>
      <button type="button" class="mdl-button mdl-js-button mdl-button--raised mdl-button--return"  (click)="volver()" >
        Ir al Carro
        <i class="material-icons">keyboard_arrow_right</i>
      </button>
    </div>
  </div>
</div>
