<div [class.hidden]="ocultarAlertaSugeridas || rolesSugeridos < 1">
  Encontramos nuevas propiedades disponibles para pago asociadas a tu RUT
  <button mdl-button (click)="ocultarAlertaSugeridas = true">
    <mdl-icon mdl-badge-overlap>close</mdl-icon>
  </button>
</div>
<div [class.hidden]="rolesSugeridos < 1">
  <button mdl-button (click)="gotoSugeridas()">
    <mdl-icon [mdl-badge]="rolesSugeridos" mdl-badge-overlap>notifications</mdl-icon>
  </button>
</div>

<h1>Pagar Mis Contribuciones</h1>
<div class="tgr-select tgr-select--buttons">
  <div class="tgr-select__label">
    Selecciona las cuotas que pagarás
  </div>
  <ul class="filter">
    <li [class.active]="seleccionada === tipo.TODAS">
      <a (click)="seleccionar(tipo.TODAS)">
        <mdl-icon *ngIf="seleccionada === tipo.TODAS">done</mdl-icon>
        Todas
      </a>
    </li>
    <li [class.active]="seleccionada === tipo.VENCIDAS">
      <a (click)="seleccionar(tipo.VENCIDAS)">
        <mdl-icon *ngIf="seleccionada === tipo.VENCIDAS">done</mdl-icon>
        Vencidas
      </a>
    </li>
  </ul>
</div>
<div *ngFor="let propiedad of propiedades">
  <app-direccion-cuotas (change)="onChange()" [propiedad]="propiedad"></app-direccion-cuotas>
</div>

<div>
  <p>Total: {{total | number}}</p>
  <p *ngIf="condonacion > 0">El monto total considera una condonación de $ {{condonacion | number}}</p>
</div>

<div class="tgr-actions">
  <div *ngIf="!complete">
    <mdl-spinner [active]="true"></mdl-spinner>
    <p>Estamos calculando tu monto a pagar</p>
  </div>
  <div *ngIf="complete" class="tgr-actions__content">
    <div>
      <button #summaryButton mdl-button (click)="summaryDialog.show()">
        <mdl-icon [mdl-badge]="cantidadSeleccionadas" mdl-badge-overlap>menu</mdl-icon>
      </button>
    </div>
    <div>
      $ {{total | number}}
    </div>
    <div class="tgr-pay">
      <button type="button" class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored"
              (click)="pay()">Pagar
      </button>
    </div>
  </div>
</div>

<div class="tgr-add">
  <div class="tgr-target-wrapper">
    <div class="tgr-target-wave tgr-target-wave--button">
      <button class="mdl-button mdl-js-button mdl-button--fab mdl-button--colored"
              [routerLink]="['propiedades/sugeridas']">
        <i class="material-icons">add</i>
      </button>
    </div>
  </div>
</div>

<mdl-dialog #summaryDialog
            [mdl-dialog-config]="{
              clickOutsideToClose: true,
              styles:{'width': '700px'},
              isModal: true,
              openFrom: summaryButton,
              enterTransitionDuration: 400,
              leaveTransitionDuration: 400}">
  <h3 class="mdl-dialog__title">Detalle de pago</h3>
  <div class="mdl-dialog__content" *ngIf="complete">
    <div class="tgr-propiedad" *ngFor="let propiedad of propiedades">
      <h2>{{propiedad.direccion}}</h2>
      <table class="mdl-data-table">
        <thead>
        <tr>
          <th>ROL</th>
          <th>Cuota</th>
          <th>Vence</th>
          <th>Monto</th>
        </tr>
        </thead>
        <tbody *ngFor="let rol of propiedad.roles">
        <tr *ngFor="let cuota of rol.cuotasSeleccionadas()">
          <td>{{rol.rolComunaSiiCod | leadingZero:3}}-{{rol.rolId | leadingZero:5}}-{{rol.subrolId | leadingZero:3}}
          </td>
          <td>{{cuota.numeroCuota}}</td>
          <td>{{cuota.fechaVencimiento | date:'dd/MMM'}}</td>
          <td>$ {{(rol.condonacion > 0 ? cuota.liqTotal.saldoTotal : cuota.liqParcial.saldoTotal) | number}}</td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>
  <div class="tgr-dialog__actions">
    <button mdl-button (click)="summaryDialog.close()" mdl-button-type="raised" mdl-colored="primary" mdl-ripple>
      Cerrar
    </button>
  </div>
</mdl-dialog>
