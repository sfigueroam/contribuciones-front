<div class="mdl-grid">
  <div class="mdl-cell mdl-cell--3-col-phone mdl-cell--4-col-desktop m-0auto text-center p-relative">
    <div class="alert-new-rol" [class.hidden]="ocultarAlertaSugeridas || rolesSugeridos < 1">
      <i mdl-button (click)="ocultarAlertaSugeridas = true" class="material-icons alert-remove">clear</i>
      <p>Encontramos nuevas propiedades disponibles para pago asociadas a tu RUT</p>
    </div>
    <div [class.hidden]="rolesSugeridos < 1" class="notifications">
      <div (click)="gotoSugeridas()">
        <mdl-icon [mdl-badge]="rolesSugeridos" mdl-badge-overlap>notifications</mdl-icon>
      </div>
    </div>
  </div>
</div>
<div class="mdl-grid">
  <div class="mdl-cell mdl-cell--4-col m-0auto text-center pay-title">
    <h5 class="title text-primary"><strong>Pagar Mis Contribuciones</strong></h5>
  </div>
</div>
<div class="mdl-grid switch-fee-text">
  <div class="mdl-cell mdl-cell--4-col m-0auto mb-0 select-fee">
    <p>Selecciona las cuotas que pagarás</p>
    <div class="tgr-select tgr-select--buttons">
      <ul class="filter">
        <li [class.active]="seleccionada === tipo.TODAS">
          <a (click)="seleccionar(tipo.TODAS)">
            <mdl-icon *ngIf="seleccionada === tipo.TODAS">done</mdl-icon>
            Todas
          </a>
        </li>
        <li [class.active]="seleccionada === tipo.VENCIDAS">
          <a (click)="seleccionar(tipo.VENCIDAS)">
            <mdl-icon *ngIf="seleccionada === tipo.VENCIDAS">done</mdl-icon>
            Vencidas
          </a>
        </li>
      </ul>
    </div>
  </div>
</div>

<div class="mdl-grid" *ngFor="let propiedad of propiedades">
  <div class="mdl-cell mdl-cell--4-col-phone mdl-cell--6-col-tablet mdl-cell--5-col m-0auto rol-card">
    <app-direccion-cuotas (change)="onChange()" [propiedad]="propiedad"></app-direccion-cuotas>
  </div>
</div>

<div class="mdl-grid">
  <div class="mdl-cell mdl-cell--4-col total-buy m-0auto">
    <p class="text-primary text-center">
      <strong>Total: $ {{total | number}}</strong>
    </p>
    <p *ngIf="condonacion > 0" class="text-success text-center">El monto total considera una condonación de $
      {{condonacion | number}}</p>
  </div>
</div>


<div class="tgr-actions tgr-mini-footer">
  <div *ngIf="!complete" class="tgr-loading2">
    <mdl-spinner [active]="true"></mdl-spinner>
    <p>Estamos calculando tu monto a pagar</p>
  </div>
  <div *ngIf="complete" class="tgr-actions__content">


    <button mdl-button (click)="summaryDialog.show()" [disabled]="total <= 0">
      <mdl-icon [mdl-badge]="cantidadSeleccionadas" mdl-badge-overlap class="mdl-28 pointer shopping-cart">view_list
      </mdl-icon>
    </button>
    <h6 class="pl-10"><strong>$ {{total | number}}</strong></h6>
    <div class="mdl-layout-spacer"></div>
    <form ngNoForm method="post" action="http://test.tesoreria.cl/ConsultaTipoDeudaWEB/enviaMedioPago">
      <input type="hidden" name="listaContribuciones" value="{{listaContribuciones}}"/>
      <button type="submit"
              [disabled]="total <= 0"
              class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect button-pay">Pagar
      </button>
    </form>
  </div>
</div>

<div class="tgr-add">
  <div class="tgr-target-wrapper">
    <div class="tgr-target-wave tgr-target-wave--button">
      <button type="button" class="mdl-button mdl-js-button mdl-button--fab mdl-button--accent new-rol"
              [routerLink]="['/main/contribuciones/agregar/nueva']">
        <i class="material-icons">add</i>
      </button>
    </div>
  </div>
</div>

<mdl-dialog #summaryDialog
            [mdl-dialog-config]="{
              clickOutsideToClose: true,
              styles:{'width': '700px'},
              isModal: true,
              classes: 'tgr-payment-detail',
              enterTransitionDuration: 400,
              leaveTransitionDuration: 400}">
  <div class="drawer-shopping-cart active">
    <p class="mdl-layout-title">Resumen de tus Cuotas</p>
    <div class="mdl-dialog__content" *ngIf="complete">
      <div class="tgr-propiedad" *ngFor="let propiedad of propiedades">
        <div *ngIf="propiedad.total > 0">
          <p class="sub-title"><strong>{{propiedad.splitName()}}</strong>($ {{propiedad.total | number}})</p>
          <table class="mdl-data-table">
            <thead>
            <tr>
              <th>ROL</th>
              <th>Cuota</th>
              <th>Vence</th>
              <th>Monto</th>
            </tr>
            </thead>
            <tbody *ngFor="let rol of propiedad.roles">
            <tr *ngFor="let cuota of rol.cuotasSeleccionadas()">
              <td>{{rol.rolComunaSiiCod | leadingZero:3}}-{{rol.rolId | leadingZero:5}}-{{rol.subrolId | leadingZero:3}}
              </td>
              <td>{{cuota.numeroCuota}}</td>
              <td>{{cuota.fechaVencimiento | date:'dd/MMM'}}</td>
              <!--<td>$ {{(rol.condonacion > 0 ? cuota.liqTotal.saldoTotal : (cuota.liqParcial ? cuota.liqParcial.saldoTotal : 0)) | number}}</td>-->
              <td>$ {{(rol.condonacion > 0 ? cuota.liqTotal.saldoTotal : cuota.liqParcial.saldoTotal ) | number}}</td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
    <div class="tgr-dialog__actions">
      <button mdl-button mdl-button-type="raised" mdl-colored="primary" mdl-ripple
              (click)="summaryDialog.close()">Cerrar
      </button>
    </div>
  </div>
</mdl-dialog>
